---
/**
 * Gallery Component
 * 
 * Reusable gallery for displaying images and videos.
 * Handles media type detection automatically.
 */
import { getMediaType, getLoadingStrategy } from '../utils/media';

interface Props {
  items: string[];
  title: string;
  columns?: 2 | 3;
}

const { items, title, columns = 2 } = Astro.props as Props;
---

{items && items.length > 0 && (
  <section class="gallery-section">
    <h2>Gallery</h2>
    <div class="gallery-grid" data-columns={columns}>
      {items.map((media, index) => {
        const mediaType = getMediaType(media);
        const isVideo = mediaType === 'video';
        const isGif = mediaType === 'gif';
        const loadingStrategy = getLoadingStrategy(mediaType);
        
        return (
          <div class:list={["gallery-item", { "is-video": isVideo }]}>
            {isVideo ? (
              <video 
                src={media} 
                autoplay 
                loop 
                muted 
                playsinline
                preload="metadata"
              >
                <track kind="captions" />
              </video>
            ) : (
              <img 
                src={media} 
                alt={`${title} - ${isGif ? 'GIF' : 'Image'} ${index + 1}`} 
                loading={loadingStrategy}
                decoding="async" 
              />
            )}
            {isVideo && (
              <div class="video-indicator">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
              </div>
            )}
          </div>
        );
      })}
    </div>
  </section>
)}

<style>
  .gallery-section {
    margin-bottom: var(--space-11);
  }
  
  .gallery-section h2 {
    font-family: var(--font-display);
    font-size: 1.375rem;
    color: var(--color-text-primary);
    margin-bottom: var(--space-7);
  }
  
  .gallery-grid {
    columns: 2;
    column-gap: var(--space-6);
  }
  
  .gallery-grid[data-columns="3"] {
    columns: 2;
  }
  
  @media (min-width: 900px) {
    .gallery-grid[data-columns="3"] {
      columns: 3;
    }
  }
  
  .gallery-item {
    border-radius: var(--radius-md);
    overflow: hidden;
    background: var(--color-bg-card);
    cursor: pointer;
    transition: transform var(--duration-slow) var(--ease-out);
    position: relative;
    break-inside: avoid;
    margin-bottom: var(--space-6);
  }
  
  .gallery-item:hover {
    transform: scale(var(--hover-scale));
  }
  
  .gallery-item img,
  .gallery-item video {
    width: 100%;
    height: auto;
    display: block;
  }
  
  .gallery-item.is-video {
    cursor: default;
  }
  
  .video-indicator {
    position: absolute;
    top: var(--space-5);
    right: var(--space-5);
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.6);
    border-radius: var(--radius-full);
    color: white;
    pointer-events: none;
  }
  
  @media (max-width: 768px) {
    .gallery-grid {
      columns: 1;
    }
  }
</style>
